# PDF Generation Requirements and Standards

## Overview
All PDF documents generated by the system (Audits, Invoices, SOWs) must follow the CFG Ninja brand styling established in the Custom Contract pdf.js template.

## Required Assets
Location: `frontend/public/pdf-assets/`

### Images
- `logos/front9.png` - Cover page logo
- `logos/pages13.png` - Header logo for internal pages
- `logos/cfg-ninja-logo.png` - Standard logo
- Other project-specific logos as needed

## PDF Styling Standards

### Colors
```javascript
const colors = {
  primary: '#ef4444',      // CFG Ninja Red
  secondary: '#1a1a1a',    // Dark background
  text: '#000000',         // Black text
  textLight: '#333333',    // Dark gray
  accent: '#ff0000',       // Bright red for highlights
  background: '#ffffff',   // White background
};
```

### Typography
- **Headings**: Helvetica-Bold, 24-28pt
- **Sub headings**: Helvetica-Bold, 16-18pt
- **Body text**: Helvetica, 10-12pt
- **Small text**: Helvetica, 8-9pt

### Page Layout
- **Size**: A4 (595.28 x 841.89 points)
- **Margins**: 50px all sides
- **Header Height**: 60px
- **Footer Height**: 40px

## Current PDF Generators

### 1. Audit PDF Generator
**Location**: `backend/src/services/pdfGenerator.js`
**Status**: ✅ Follows brand standards
**Features**:
- Cover page with front9.png
- Headers with pages13.png
- CFG Ninja color scheme
- Comprehensive audit report sections

### 2. Invoice PDF Generator
**Location**: `backend/src/services/invoicePDFGenerator.js`
**Status**: ⚠️ Needs update to match brand standards
**Required Changes**:
- [ ] Add cover page with front9.png
- [ ] Update headers to use pages13.png
- [ ] Apply CFG Ninja color scheme
- [ ] Match typography standards
- [ ] Add footer with company branding

### 3. SOW PDF Generator
**Location**: `backend/src/services/sowPDFGenerator.js`
**Status**: ⚠️ Needs update to match brand standards
**Required Changes**:
- [ ] Add cover page with front9.png
- [ ] Update headers to use pages13.png
- [ ] Apply CFG Ninja color scheme
- [ ] Match typography standards
- [ ] Ensure all 14 sections follow template

## Cover Page Template

```javascript
function addCoverPage(doc, data) {
  // Background
  doc.rect(0, 0, doc.page.width, doc.page.height)
     .fill('#1a1a1a');

  // Logo
  doc.image('frontend/public/pdf-assets/logos/front9.png', {
    fit: [300, 150],
    align: 'center',
    valign: 'center',
    x: (doc.page.width - 300) / 2,
    y: 150
  });

  // Document Title
  doc.fillColor('#ef4444')
     .fontSize(48)
     .font('Helvetica-Bold')
     .text('DOCUMENT TITLE', {
       align: 'center',
       y: 350
     });

  // Subtitle/Details
  doc.fillColor('#ffffff')
     .fontSize(16)
     .font('Helvetica')
     .text(`Document Number: ${data.number}`, {
       align: 'center',
       y: 420
     });

  // Date
  doc.fontSize(14)
     .text(formatDate(data.date), {
       align: 'center',
       y: 450
     });

  doc.addPage();
}
```

## Header Template

```javascript
function addPageHeader(doc, pageNumber, totalPages) {
  // Header background
  doc.rect(0, 0, doc.page.width, 60)
     .fill('#1a1a1a');

  // Logo
  doc.image('frontend/public/pdf-assets/logos/pages13.png', 20, 10, {
    height: 40
  });

  // Page number
  doc.fillColor('#ffffff')
     .fontSize(10)
     .text(`Page ${pageNumber} of ${totalPages}`, 
       doc.page.width - 120, 25, {
         width: 100,
         align: 'right'
       });
}
```

## Footer Template

```javascript
function addPageFooter(doc, yPosition) {
  const footerY = doc.page.height - 40;
  
  doc.fontSize(8)
     .fillColor('#666666')
     .text('CFG Ninja Audits | https://cfg.ninja | @cfgninjaaudits', 
       50, footerY, {
         width: doc.page.width - 100,
         align: 'center'
       });
}
```

## Import from JSON Feature

### Backend Endpoint
**URL**: `POST /api/projects/import-json`
**File**: `backend/src/routes/importProjects.js`

### Data Mapping
Maps Custom Contract `data.json` format to Project schema:
```javascript
{
  name: jsonData.name,
  symbol: jsonData.symbol,
  contract_address: jsonData.address,
  blockchain: jsonData.Platform,
  // ... see importProjects.js for full mapping
}
```

### Frontend Component
**Location**: TBD - Add to Admin Settings or Projects page
**Features**:
- File upload (accepts .json)
- Preview before import
- Conflict detection
- Import confirmation

## SOW → Invoice Generation

### Backend Endpoint
**URL**: `POST /api/sow/:id/generate-invoice`
**File**: `backend/routes/sow.js`

### Data Mapping
- Client info → Invoice client
- Pricing items → Invoice items
- Pricing totals → Invoice totals
- Project name → Invoice notes
- Payment terms → Invoice terms

### Frontend Integration
Add "Generate Invoice" button to SOW detail page

## Testing Checklist

### For All PDF Generators:
- [ ] Cover page displays correctly with front9.png
- [ ] Headers use pages13.png on all pages except cover
- [ ] All colors match CFG Ninja brand (#ef4444, #1a1a1a, etc.)
- [ ] Typography uses Helvetica/Helvetica-Bold at specified sizes
- [ ] Page numbers display correctly
- [ ] Footer shows CFG Ninja contact info
- [ ] PDF generates without errors
- [ ] All sections are properly formatted
- [ ] Tables and lists render correctly
- [ ] File size is reasonable (< 5MB for typical docs)

## Example SOW Import

The file `scripts/CFG_Ninja_SOW_kDex_20251221.pdf` serves as the reference example for:
- Proper SOW formatting
- Section organization
- Content structure
- Visual presentation

Use this as a guide when testing SOW generation to ensure output matches professional standards.

## Next Steps

1. **Update Invoice PDF Generator**:
   - Add cover page
   - Update styling to match standards
   - Test with various invoice types

2. **Update SOW PDF Generator**:
   - Verify cover page implementation
   - Ensure all 14 sections follow template
   - Test comprehensive SOW generation

3. **Add Frontend Components**:
   - JSON import UI in settings/projects
   - "Generate Invoice" button on SOW pages
   - Preview functionality

4. **Import Example SOW**:
   - Parse CFG_Ninja_SOW_kDex_20251221.pdf
   - Create SOW record in database
   - Use as template for future SOWs

## Reference Files

- Custom Contract PDF Template: `e:\Desktop\Old Desktop November 2023\audits\PDFscript\CFGNinjaScripts\Custom Contract\pdf.js`
- Data JSON Format: `e:\Desktop\Old Desktop November 2023\audits\PDFscript\CFGNinjaScripts\Custom Contract\data.json`
- Example SOW: `g:\auditportal\scripts\CFG_Ninja_SOW_kDex_20251221.pdf`
- Assets: `g:\auditportal\frontend\public\pdf-assets\`
